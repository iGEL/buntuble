---
- name: Add PPA
  apt_repository: repo='ppa:neovim-ppa/unstable'
  become: yes
  tags: [neovim, sudo]

- name: Install Neovim
  apt: name=neovim state=latest
  become: yes
  tags: [neovim, sudo]

- name: Setup alternatives
  alternatives: name={{item}} path=/usr/bin/nvim
  with_items:
    - vi
  become: yes
  tags: [neovim, sudo]

- name: Download ripgrep
  get_url:
    url: https://github.com/BurntSushi/ripgrep/releases/download/{{ripgrep_version}}/{{ripgrep_version_arch}}.tar.gz
    dest: /home/{{ansible_user_id}}/Downloads/
  tags: [neovim, sudo, rg]

- name: Install ripgrep
  command: tar xf /home/{{ansible_user_id}}/Downloads/{{ripgrep_version_arch}}.tar.gz --strip-components=1 -C /usr/local/bin {{ripgrep_version_arch}}/rg
  become: yes
  tags: [neovim, sudo, rg]

- name: Install xsel
  apt:
    name: xsel
    state: latest
  become: yes
  tags: [neovim, sudo]

- name: symlink the ~/.config/nvim directory
  file: >
    src=/home/{{ ansible_user_id }}/dev/files/nvim
    dest=/home/{{ ansible_user_id }}/.config/nvim
    state=link
  tags: [neovim]

- name: Setup vundle
  git: >
    repo=https://github.com/gmarik/Vundle.vim.git
    dest=/home/{{ ansible_user_id }}/.config/nvim/bundle/Vundle.vim
  tags: [neovim]

- name: vundle install
  command: /usr/bin/nvim -u ~/dev/files/nvim/install_vundle.vimrc +PluginInstall +qall
  tags: [neovim]
